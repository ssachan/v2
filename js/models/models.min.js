window.Account=Backbone.Model.extend({defaults:{id:null,quizzesAttempted:null,dpUrl:DP_PATH+"avatar.jpg"},urlRoot:" ",initialize:function(){if(!this.get("quizzesAttemptedArray")){this.set({quizzesAttemptedArray:new Array})}this.on("change:quizzesAttempted",function(e){e.get("quizzesAttemptedArray").length=0;if(e.get("quizzesAttempted")!=null&&e.get("quizzesAttemptedArray")){e.get("quizzesAttemptedArray").push.apply(this.get("quizzesAttemptedArray"),JSON.parse(e.get("quizzesAttempted")))}});this.on("change:dp",function(e){if(e.get("dp")==true){e.set("dpUrl",DP_PATH+e.get("id")+".jpg")}else{e.set("dpUrl",DP_PATH+"avatar.jpg")}})},fConnect:function(){user.login()},gConnect:function(){glogin()},login:function(e,t){var n=Config.serverUrl+"login";console.log("Loggin in... ");var r={email:e,password:t,streamId:1};$.ajax({url:n,type:"POST",dataType:"json",data:r,success:function(e){if(e.status==STATUS.SUCCESS){account.set(e.data);window.location="#"}else{helper.processStatus(e)}},error:function(e){helper.processStatus(e.responseText)}})},logout:function(){var e=Config.serverUrl+"logout";$.ajax({url:e,type:"GET",dataType:"json",success:function(e){if(e.status==STATUS.SUCCESS){console.log("log out");if(user){user.clear()}account.reset();account.get("quizzesAttemptedArray").length=0;activeQuiz=null;var t=new SignUpView({model:account});app.showView("#content",t);t.onRender()}helper.processStatus(e)},error:function(e){helper.processStatus(e.responseText)}})},invite:function(e){var t=Config.serverUrl+"invite";console.log("invite up... ");$.ajax({url:t,type:"POST",dataType:"json",data:e,success:function(e){helper.processStatus(e)},error:function(e){helper.processStatus(e.responseText)}})},fblogin:function(e){var t=Config.serverUrl+"fblogin";console.log("fb up... ");$.ajax({url:t,type:"POST",dataType:"json",data:e,success:function(e){if(e.status==STATUS.SUCCESS){account.set(e.data);window.location="#"}else{helper.processStatus(e)}},error:function(e){helper.processStatus(e.responseText)}})},ccSignUp:function(e){var t=Config.serverUrl+"ccsignup";console.log("signing up... ");$.ajax({url:t,type:"POST",dataType:"json",data:e,success:function(t){if(t.status==STATUS.SUCCESS){account.set(t.data);helper.track("csup",{id:account.get("id"),ccode:e.ccode,email:account.get("email")});window.location="#"}else{helper.processStatus(t)}},error:function(e){helper.processStatus(e.responseText)}})},signUp:function(e){var t=Config.serverUrl+"signup";console.log("signing up... ");$.ajax({url:t,type:"POST",dataType:"json",data:e,success:function(e){if(e.status==STATUS.SUCCESS){account.set(e.data);helper.track("sup",{id:account.get("id"),email:account.get("email")});window.location="#"}else{helper.processStatus(e)}},error:function(e){helper.processStatus(e.responseText)}})},forgotPass:function(e){var t=Config.serverUrl+"forgotpass";console.log("forgot pass... ");var n={email:e};$.ajax({url:t,type:"POST",dataType:"json",data:n,success:function(e){helper.processStatus(e)},error:function(e){helper.processStatus(e.responseText)}})},changePass:function(e,t){var n=Config.serverUrl+"changepass";console.log("change pass... ");$.ajax({url:n,type:"POST",dataType:"json",data:{oldpassword:e,newpassword:t,accountId:this.get("id")},success:function(e){helper.processStatus(e)},error:function(e){helper.processStatus(e.responseText)}})},isAuth:function(){url=Config.serverUrl+"isAuth";$.ajax({url:url,type:"GET",dataType:"json",success:function(e){if(e.status==STATUS.SUCCESS){account.set(e.data)}app=new AppRouter;Backbone.history.start()}})}});var account=new Account;window.Stream=Backbone.Model.extend({urlRoot:Config.serverUrl+"streams/",initialize:function(){}});window.StreamCollection=Backbone.Collection.extend({model:Stream,url:Config.serverUrl+"streams/"});var streams=new StreamCollection;window.Question=Backbone.Model.extend({urlRoot:Config.serverUrl+"questions/",defaults:{correctAnswer:null,status:null,timeTaken:null,hasAttempted:false,optionSelected:null,isCorrect:null,videoData:null,typeString:""},initialize:function(){var e=this.get("l3Id");if(e){var t=sectionL3.get(e);var n=t.get("l2Id");this.set("l2Id",n);var r=sectionL2.get(n);this.set("l1Id",r.get("l1Id"))}if(this.get("optionSelected")){this.set("isCorrect",this.isOptionSelectedCorrect(this.get("optionSelected")))}if(this.get("typeId")){var i=this.get("typeId");switch(i){case"1":this.set("typeString","");break;case"2":this.set("typeString","Multiple Choice");break;case"3":this.set("typeString","Integer Type");break;case"4":this.set("typeString","Matrix Type");break}}},getOption:function(e){var t=this.get("typeId");switch(t){case"1":var n=this.get("options").split(SEPARATOR);return n[e]}},getScore:function(){var e=this.get("typeId");switch(e){case"1":if(this.isOptionSelectedCorrect(this.get("optionSelected"))==true){return parseInt(this.get("correctScore"))}else if(this.isOptionSelectedCorrect(this.get("optionSelected"))==false){return parseInt("-"+this.get("incorrectScore"))}else{return null}break;case"2":if(this.isOptionSelectedCorrect(this.get("optionSelected"))==true){return parseInt(this.get("correctScore"))}else if(this.isOptionSelectedCorrect(this.get("optionSelected"))==false){return parseInt("-"+this.get("incorrectScore"))}else{return null}break;case"3":if(this.isOptionSelectedCorrect(this.get("optionSelected"))==true){return parseInt(this.get("correctScore"))}else if(this.isOptionSelectedCorrect(this.get("optionSelected"))==false){return parseInt("-"+this.get("incorrectScore"))}else{return null}break;case"4":if(this.isOptionSelectedCorrect(this.get("optionSelected"))==true){return parseInt(this.get("correctScore"))}else if(this.isOptionSelectedCorrect(this.get("optionSelected"))==false){var t=0;var n=parseInt(this.get("optionScore"));if(n!=0){var r=this.get("correctAnswer").split(SEPARATOR+SEPARATOR);var i=this.get("optionSelected").split(SEPARATOR+SEPARATOR);var s=r.length;for(var o=0;o<s;o++){if(i[o]!=null&&i[o]==r[o]){t=t+n}}}return t}else{return null}break}},isOptionSelectedCorrect:function(e){var t=null;var n=this.get("correctAnswer");if(e&&e!=null){t=e==n?true:false}return t},setStatus:function(){var e=null;var t=this.get("correctAnswer");var n=this.get("optionSelected");if(n&&n!=null){e=n==t?true:false}this.set("status",e)}});window.QuestionCollection=Backbone.Collection.extend({model:Question,url:Config.serverUrl+"questions/"});var quizQuestions=new QuestionCollection;var attemptedQuestions=new QuestionCollection;var question=new Question;window.Quiz=Backbone.Model.extend({defaults:{hasAttempted:false,numCorrect:0,numIncorrect:0,numTotal:0,selectedAnswers:null,timePerQuestion:null,statusPerQuestion:null,descriptionShort:null,maxScore:0,score:0,timeTaken:0,topics:"",l1:null,fid:null,firstName:null,lastName:null,attemptedAs:null,logo:null,fdpURL:DP_PATH+"avatar.jpg",state:null,startTime:null,reason:null},urlRoot:Config.serverUrl+"quizzes/",STATUS_NOTSTARTED:0,STATUS_COMPLETED:1,STATUS_INPROGRESS:2,STATUS_INTERRUPTED:3,initialize:function(){if(!this.get("questionIdsArray")){this.set({questionIdsArray:new Array})}if(!this.get("selectedAnswersArray")){this.set({selectedAnswersArray:new Array})}if(!this.get("timePerQuestionArray")){this.set({timePerQuestionArray:new Array})}if(this.get("questionIds")!=null){this.get("questionIdsArray").push.apply(this.get("questionIdsArray"),this.get("questionIds").split(SEPARATOR))}if(this.get("selectedAnswers")!=null){this.get("selectedAnswersArray").push.apply(this.get("selectedAnswersArray"),JSON.parse(this.get("selectedAnswers")))}if(this.get("timePerQuestion")!=null){this.get("timePerQuestionArray").push.apply(this.get("timePerQuestionArray"),JSON.parse(this.get("timePerQuestion")));this.setTimeTaken()}if(this.get("statusPerQuestion")!=null){this.get("statusPerQuestionArray").push.apply(this.get("statusPerQuestionArray"),JSON.parse(this.get("statusPerQuestion")))}if(this.get("score")!=null){}if(this.get("fid")!=null){this.set("fdpURL",DP_PATH+this.get("fid")+".jpg")}if(this.get("l2Ids")!=null){var e=this.get("l2Ids").split(SEPARATOR);var t=e.length;if(t==1){var n=sectionL2.get(e[0]);this.set("topics",n.get("displayName"));this.set("l1",sectionL1.get(n.get("l1Id")).get("id"))}else{var r=[];for(var i=0;i<t;i++){var n=sectionL2.get(e[i]);r.push(n.get("displayName"));this.set("l1",sectionL1.get(n.get("l1Id")).get("id"))}this.set("topics",r.join(","))}}if(this.get("l1")!=null){this.set("l1DisplayName",sectionL1.get(this.get("l1")).get("displayName"));this.set("logo","img/l1-"+this.get("l1")+".png")}if(this.get("startTime")!=null){this.setStatus()}else{this.set("status",this.STATUS_NOTSTARTED)}this.on("change:questionIds",function(e){if(e.get("questionIds")!=null&&e.get("questionIdsArray")){e.get("questionIdsArray").push.apply(this.get("questionIdsArray"),e.get("questionIds").split(SEPARATOR));e.setTimeTaken()}});this.on("change:selectedAnswers",function(e){if(e.get("selectedAnswers")!=null&&e.get("selectedAnswersArray")){e.get("selectedAnswersArray").push.apply(this.get("selectedAnswersArray"),JSON.parse(e.get("selectedAnswers")))}});this.on("change:timePerQuestion",function(e){if(e.get("timePerQuestion")!=null&&e.get("timePerQuestionArray")){e.get("timePerQuestionArray").push.apply(this.get("timePerQuestionArray"),JSON.parse(e.get("timePerQuestion")));e.setTimeTaken()}});this.on("change:startTime",function(e){e.setStatus()});this.on("change:attemptedAs",function(e){e.setStatus()});this.on("change:state",function(e){e.setStatus()});if(this.get("difficulty")){var s=this.get("difficulty");switch(s){case"1":this.set("difficultyString","Easy");break;case"2":this.set("difficultyString","Medium");break;case"3":this.set("difficultyString","Hard");break}}},setTimeTaken:function(){var e=0;var t=this.get("timePerQuestionArray").length;for(var n=0;n<t;n++){v=parseInt(this.get("timePerQuestionArray")[n]);if(!isNaN(v))e+=v}this.set("timeTaken",e)},setStatus:function(){if(this.get("attemptedAs")==null){this.set("status",this.STATUS_INTERRUPTED)}else{if(this.get("state")==null){this.set("status",this.STATUS_INPROGRESS)}else if(this.get("state")==this.get("questionIdsArray").length){this.set("status",this.STATUS_COMPLETED)}else{this.set("status",this.STATUS_INPROGRESS)}}},updateAttemptedAs:function(){var e=Config.serverUrl+"attemptedAs/";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),quizId:this.get("id"),attemptedAs:this.get("attemptedAs")},success:function(e){if(e.status==STATUS.SUCCESS){if(e.data==1){Manager.loadQuiz(t)}else{Manager.loadPractice(t)}}else{helper.showError(e.data)}}})},submitPracticeQuestion:function(){var e=Config.serverUrl+"submitPractice";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),quizId:this.get("id"),streamId:streamId,state:this.get("state"),logs:logs.toJSON(),isLast:0},success:function(e){if(e.status==STATUS.SUCCESS){}else{helper.processStatus(e)}},error:function(e){console.log(e)}})},submitPracticeResults:function(){var e=Config.serverUrl+"submitPractice";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),quizId:this.get("id"),streamId:streamId,state:this.get("state"),logs:logs.toJSON(),isLast:1},success:function(e){if(e.status==STATUS.SUCCESS){t.set(e.data);t.set("status",t.STATUS_COMPLETED);app.quiz(t.get("id"))}else{helper.processStatus(e)}},error:function(e){console.log(e)}})},submitQuiz:function(){var e=Config.serverUrl+"submitQuiz";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),quizId:this.get("id"),streamId:streamId,state:this.get("state"),logs:logs.toJSON()},success:function(e){if(e.status==STATUS.SUCCESS){t.set(e.data);t.set("status",t.STATUS_COMPLETED);app.quiz(t.get("id"))}else{helper.processStatus(e)}},error:function(e){console.log(e)}})},addReco:function(){var e=Config.serverUrl+"addQuizReco";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),quizId:this.get("id")},success:function(e){if(e.status){helper.processStatus(e)}},error:function(e){console.log(e)}})}});window.QuizCollection=Backbone.Collection.extend({model:Quiz,url:Config.serverUrl+"quizzes/"});var quizLibrary=new QuizCollection;var quizHistory=new QuizCollection;var quizReco=new QuizCollection;window.Fac=Backbone.Model.extend({defaults:{dpUrl:DP_PATH+"avatar.jpg",dpUrlL:DP_PATH+"avatar.jpg"},urlRoot:Config.serverUrl+"fac/",initialize:function(){if(this.get("id")!=null){this.set("dpUrl",DP_PATH+this.get("id")+".jpg")}this.on("change:id",function(e){if(e.get("id")!=null&&e.get("id")!=""){e.set("dpUrl",DP_PATH+e.get("id")+".jpg");e.set("dpUrlL",DP_PATH+e.get("id")+"-l.jpg")}else{e.set("dpUrl",DP_PATH+"avatar.jpg");e.set("dpUrlL",DP_PATH+"avatar.jpg")}});if(this.get("l1Ids")!=null){this.set("l1DisplayName",sectionL1.get(this.get("l1Ids")).get("displayName"))}},addReco:function(){var e=Config.serverUrl+"addFacReco";var t=this;$.ajax({url:e,type:"POST",dataType:"json",data:{accountId:account.get("id"),facId:this.get("id")},success:function(e){if(e.status){if(e.status==STATUS.SUCCESS){t.set("rec",parseInt(t.get("rec"))+1)}helper.processStatus(e)}},error:function(e){console.log(e)}})}});window.FacCollection=Backbone.Collection.extend({model:Fac,url:Config.serverUrl+"fac/",search:function(e){if(e=="")return this;var t=new RegExp(e,"gi");return _(this.filter(function(e){return t.test(e.get("firstName"))}))}});var facDirectory=new FacCollection;var facQuizzes=new QuizCollection;var fac=new Fac;window.Package=Backbone.Model.extend({defaults:{},urlRoot:Config.serverUrl+"packages/",initialize:function(){},purchase:function(){var e=Config.serverUrl+"purchase";$.ajax({url:e,type:"POST",data:{packageId:this.get("id"),accountId:account.get("id"),streamId:streamId},dataType:"json",success:function(e){if(e.status==STATUS.SUCCESS){account.set("quizzesRemaining",e.data);e.data="Added package. Your account now has "+e.data+" tests.";helper.processStatus(e)}}})}});window.PackageCollection=Backbone.Collection.extend({model:Package,url:Config.serverUrl+"packages/"});var packages=new PackageCollection;window.SectionL1=Backbone.Model.extend({urlRoot:Config.serverUrl+"l1/",initialize:function(){}});window.SectionL1Collection=Backbone.Collection.extend({model:SectionL1,url:Config.serverUrl+"l1/"});window.SectionL2=Backbone.Model.extend({urlRoot:Config.serverUrl+"l2/",initialize:function(){}});window.SectionL2Collection=Backbone.Collection.extend({model:SectionL2,url:Config.serverUrl+"l2/"});window.SectionL3=Backbone.Model.extend({urlRoot:Config.serverUrl+"l3/",initialize:function(){}});window.SectionL3Collection=Backbone.Collection.extend({model:SectionL3,url:Config.serverUrl+"l3/"});var sectionL1=new SectionL1Collection;var sectionL2=new SectionL2Collection;var sectionL3=new SectionL3Collection;window.ScoreL1=Backbone.Model.extend({urlRoot:Config.serverUrl+"l1/",initialize:function(){}});window.ScoreL1Collection=Backbone.Collection.extend({model:ScoreL1,url:Config.serverUrl+"l1/"});window.ScoreL2=Backbone.Model.extend({urlRoot:Config.serverUrl+"l2/",initialize:function(){}});window.ScoreL2Collection=Backbone.Collection.extend({model:ScoreL2,url:Config.serverUrl+"l2/"});window.ScoreL3=Backbone.Model.extend({urlRoot:Config.serverUrl+"l3/",initialize:function(){}});window.ScoreL3Collection=Backbone.Collection.extend({model:ScoreL3,url:Config.serverUrl+"l3/"});var scoreL1=new ScoreL1Collection;var scoreL2=new ScoreL2Collection;var scoreL3=new ScoreL3Collection;window.Log=Backbone.Model.extend({urlRoot:" ",initialize:function(){this.set("t",(new Date).getTime())},defaults:{t:null,e:null,q:null,o:null}});window.LogCollection=Backbone.Collection.extend({model:Log,eventids:{OPTION_SELECT:0,OPTION_DESELECT:1,QUESTION_OPEN:3,QUESTION_CLOSE:4,QUESTION_MARK:5,QUESTION_UNMARK:6,QUESTION_SUBMIT:7,TEST_SUBMIT:8,TEST_PAUSE:9,TEST_START:10},addEntry:function(e,t,n){var r={e:this.eventids[e]};if(t)r.q=t;if(n)r.o=n;this.add(new Log(r))},comparator:function(e){return e.get("t")}});var logs=new LogCollection